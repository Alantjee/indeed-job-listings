---
title: "Indeed.com Job Listings Analysis"
output:
  pdf_document: default
  html_document: default
---

```{r echo=FALSE, warning=FALSE, message=FALSE}
library(reshape)
library(stringr)
library(tidyr)
library(dplyr)
library(ggplot2)
```


```{r echo=FALSE, warning=FALSE, message=FALSE}
data_scientist <- read.csv("../../gen/data-preparation/output/data_scientist_clean.csv")
data_analist <- read.csv("../../gen/data-preparation/output/data_analist_clean.csv")
marketing_analist<- read.csv("../../gen/data-preparation/output/marketing_analist_clean.csv")
marketeer <- read.csv("../../gen/data-preparation/output/marketeer_clean.csv")
```

# 1. Overview of the data

### 1.1 This is how the data_scientist data set looks like:
We can see that there are `r length(data_scientist$X)` job listings. It contains `r ncol(data_scientist)` columns.

```{r}
colnames(data_scientist)
```

Here can be observed a summary of data_scientist.

```{r}
summary(data_scientist)
```


### 1.2 This is how the data_analist data set looks like:
We can see that there are `r length(data_analist$X)` job listings. It contains `r ncol(data_analist)` columns.

```{r}
colnames(data_analist)
```

Here can be observed a summary of data_analist.

```{r}
summary(data_analist)
```

### 1.3 This is how the marketing_analist data set looks like:
We can see that there are `r length(marketing_analist$X)` job listings. It contains `r ncol(marketing_analist)` columns.

```{r}
colnames(marketing_analist)
```

Here can be observed a summary of marketing_analist.

```{r}
summary(marketing_analist)
```

### 1.4 This is how the marketeer data set looks like:
We can see that there are `r length(marketeer$X)` job listings. It contains `r ncol(marketeer)` columns.

```{r}
colnames(marketeer)
```

Here can be observed a summary of marketeer.

```{r}
summary(marketeer)
```

# 2. Looking at the frequency of some core skills from the job descriptions

```{r echo=FALSE, warning=FALSE, message=FALSE}
data_scientist <- read.csv("../../gen/data-preparation/output/data_scientist_clean.csv")
data_analist <- read.csv("../../gen/data-preparation/output/data_analist_clean.csv")
marketing_analist<- read.csv("../../gen/data-preparation/output/marketing_analist_clean.csv")
marketeer <- read.csv("../../gen/data-preparation/output/marketeer_clean.csv")
```

### 2.1 Getting the skill counts for the most important skills in data science jobs

```{r}
skills_data_science <- data_scientist %>%
  mutate(SQL = str_count(data_scientist$description, "SQL" )) %>%
  mutate(HTML = str_count(data_scientist$description, "HTML")) %>%
  mutate(SPSS = str_count(data_scientist$description, "SPSS")) %>%
  mutate(PowerBI = str_count(data_scientist$description, "Power BI")) %>%
  mutate(AWS = str_count(data_scientist$description, "AWS")) %>%
  mutate(Python = str_count(data_scientist$description, "Python" )) %>%
  mutate(Hadoop = str_count(data_scientist$description, "Hadoop" )) %>%
  mutate(Java = str_count(data_scientist$description, "Java" )) %>%
  mutate(Apache = str_count(data_scientist$description, "Apache" )) %>%
  mutate(Excel = str_count(data_scientist$description, "Excel")) %>%
  mutate(AWS = str_count(data_scientist$description, "AWS"))%>%
  mutate(Azure = str_count(data_scientist$description, "Azure"))%>% 
  mutate(Tableau = str_count(data_scientist$description, "Tableau" )) %>%
  mutate(TensorFlow = str_count(data_scientist$description, "TensorFlow" )) %>%  
  mutate(big_data = str_count(data_scientist$description, "big data" )) %>% 
  mutate(machine_learning = str_count(data_scientist$description, "machine learning" )) %>%
  mutate(SAS = str_count(data_scientist$description, "SAS" )) %>% 
  mutate(R = str_count(data_scientist$description, "\\bR\\b" ))# add\\bR\\b because otherwise words all capital letter R's will be counted, which includes any r at the beginning of a sentence.
```

```{r}
#get only skills and their counts from the entire skills dataframe and arrange by count
table_data_science <- gather(skills_data_science, "Skill", "Count", 15:31) %>%  arrange( Count) 
#make a plot of the counts for each skill
count_plot_data_science <- ggplot(data=table_data_science, aes(x=Skill, y=Count)) + geom_bar(stat="identity") + coord_flip()#flip coordinates because skills on x axis gives messy text
count_plot_data_science
```
This is a plot of the core technical skills and their counts in the data scientist job ads. As we can see, there are  4 clear top skills to learn to become a data scientist. These include Python, SQL, R and machine learning, with each having counts over 300. Other important skills seem to be Java, Excel, Azure and AWS(amazon web services) with each having counts over 100. 

However, counts do not paint the entire picture. Some job ads have double or even more counts of the same skill within the same description. To control for this, we also calculate the percentage of job ads wherein each skill is featured in the description. For example, if in every second job ad, the skill R is mentioned, it will have a value of 0.5.  
```{r}
#get the count dta from the entire dataset
subset_data_science <- skills_data_science[15:31]  
#count the number of advertisements in which each skill is mentioned
occurences_data_science <- colSums(subset_data_science != 0)
#percentage of total number of advertisements
percentage_data_science <- occurences_data_science/nrow(subset_data_science)
#add skillnames into the dataframe 
percentage_data_science <- as.data.frame(percentage_data_science)
percentage_data_science$Skill <- c("SQL","HTML", "SPSS","Power BI", "AWS", "Python", "Hadoop", "Java", "Apache", "Excel", "Azure", "Tableau", "TensorFlow", "big_data", "machine_learning", "SAS", "R")
#plot the percentage of occurence per skill level
percentage_plot_data_science <- ggplot(data=percentage_data_science, aes(x=Skill, y=percentage_data_science)) + geom_bar(stat="identity") + coord_flip()
percentage_plot_data_science
```
The percentage plot shows us that the percentage analysis bears quite similar results to the count analysis. Again Python, R, machine learning and SQL are the most important skills. However, the difference between Python and the other skills is bigger in terms of percentage occurrence than in count. Also in percentage terms, Excel is becoming more important, catching up with the top 4 skills and being almost equally important as machine learning.  


### 2.2 Getting the skill counts for the most important skills in data_analist jobs

```{r}
skills_data_analist <- data_analist %>%
  mutate(SQL = str_count(data_analist$description, "SQL" )) %>%
  mutate(HTML = str_count(data_analist$description, "HTML")) %>%
  mutate(SPSS = str_count(data_analist$description, "SPSS")) %>%
  mutate(PowerBI = str_count(data_analist$description, "Power BI")) %>%
  mutate(AWS = str_count(data_analist$description, "AWS")) %>%
  mutate(Python = str_count(data_analist$description, "Python" )) %>%
  mutate(Hadoop = str_count(data_analist$description, "Hadoop" )) %>%
  mutate(Java = str_count(data_analist$description, "Java" )) %>%
  mutate(Apache = str_count(data_analist$description, "Apache" )) %>%
  mutate(Excel = str_count(data_analist$description, "Excel")) %>%
  mutate(AWS = str_count(data_analist$description, "AWS"))%>%
  mutate(Azure = str_count(data_analist$description, "Azure"))%>% 
  mutate(Tableau = str_count(data_analist$description, "Tableau" )) %>%
  mutate(TensorFlow = str_count(data_analist$description, "TensorFlow" )) %>%  
  mutate(big_data = str_count(data_analist$description, "big data" )) %>% 
  mutate(machine_learning = str_count(data_analist$description, "machine learning" )) %>%
  mutate(SAS = str_count(data_analist$description, "SAS" )) %>% 
  mutate(R = str_count(data_analist$description, "\\bR\\b" ))# add\\bR\\b because otherwise words all capital letter R's will be counted, which includes any r at the beginning of a sentence.
```


```{r}
#get only skills and their counts from the entire skills dataframe
table_data_analist <- gather(skills_data_analist, "Skill", "Count", 15:31) %>%  arrange( Count) 
#make a plot of the counts for each skill
count_plot_data_analist <- ggplot(data=table_data_analist, aes(x=Skill, y=Count)) + geom_bar(stat="identity") + coord_flip()#flip coordinates because skills on x axis gives messy text
count_plot_data_analist
```
As we can see, quite a different picture for data analist jobs. The clear winner is SQL, which approaches the 500 count. After SQL, Excel is the second most sought after skill with over 350 counts. In 3rd and 4th come the 2 programming languages Python and R, with Python slightly edging R in terms of importance. Other important skills inclead Tableau, Power Bi and Azure. 


```{r}
#get the count data from the entire dataset
subset_data_analist <- skills_data_analist[15:31]  
#count the number of advertisements in which each skill is mentioned
occurences_data_analist <- colSums(subset_data_analist != 0)
#percentage of total number of advertisements
percentage_data_analist <- occurences_data_analist/nrow(subset_data_analist)
#add skillnames into the dataframe 
percentage_data_analist <- as.data.frame(percentage_data_analist)
percentage_data_analist$Skill <- c("SQL","HTML","SPSS","Power BI", "AWS", "Python", "Hadoop", "Java", "Apache", "Excel", "Azure", "Tableau", "TensorFlow", "big_data", "machine_learning", "SAS", "R")
#plot the percentage of occurence per skill level
percentage_plot_data_analist <- ggplot(data=percentage_data_analist, aes(x=Skill, y=percentage_data_analist)) + geom_bar(stat="identity") + coord_flip()
percentage_plot_data_analist
```
Again similar results for the percentage analysis. However, the difference between SQL and Excel is declining, with both being almost equally important. Also the difference with number 3 Python seems slightly smaller than in the count analysis. Again other important skills are R, Power BI and Tableau. 


### 2.3 Getting the skill counts for the most important skills in marketing_analist jobs

```{r}
skills_marketing_analist <- marketing_analist %>%
  mutate(SQL = str_count(marketing_analist$description, "SQL" )) %>%
  mutate(HTML = str_count(marketing_analist$description, "HTML")) %>%
  mutate(SPSS = str_count(marketing_analist$description, "SPSS")) %>%
  mutate(PowerBI = str_count(marketing_analist$description, "Power BI")) %>%
  mutate(AWS = str_count(marketing_analist$description, "AWS")) %>%
  mutate(Python = str_count(marketing_analist$description, "Python" )) %>%
  mutate(Hadoop = str_count(marketing_analist$description, "Hadoop" )) %>%
  mutate(Java = str_count(marketing_analist$description, "Java" )) %>%
  mutate(Apache = str_count(marketing_analist$description, "Apache" )) %>%
  mutate(Excel = str_count(marketing_analist$description, "Excel")) %>%
  mutate(AWS = str_count(marketing_analist$description, "AWS"))%>%
  mutate(Azure = str_count(marketing_analist$description, "Azure"))%>% 
  mutate(Tableau = str_count(marketing_analist$description, "Tableau" )) %>%
  mutate(TensorFlow = str_count(marketing_analist$description, "TensorFlow" )) %>%  
  mutate(big_data = str_count(marketing_analist$description, "big data" )) %>% 
  mutate(machine_learning = str_count(marketing_analist$description, "machine learning" )) %>%
  mutate(SAS = str_count(marketing_analist$description, "SAS" )) %>% 
  mutate(R = str_count(marketing_analist$description, "\\bR\\b" ))# add\\bR\\b because otherwise words all capital letter R's will be counted, which includes any r at the beginning of a sentence.
```

```{r}
#get only skills and their counts from the entire skills dataframe
table_marketing_analist <- gather(skills_marketing_analist, "Skill", "Count", 15:31) %>%  arrange( Count) 
#make a plot of the counts for each skill
count_plot_marketing_analist <- ggplot(data=table_marketing_analist, aes(x=Skill, y=Count)) + geom_bar(stat="identity") + coord_flip()#flip coordinates because skills on x axis gives messy text
count_plot_marketing_analist
```

The clear winner for skills to learn for a marketing analyst is Excel, being the only skill reaching a count over 200. Other important skills are SQL, Tableau, R and Python, with all of them being very close to eachother in terms of relative importance. Then after quite a big gap, skills such as Power BI, AWS and Azure come, clearly seemingly not that meaningful to learn as a marketing analist.  
```{r}
#get the count data from the entire dataset
subset_marketing_analist <- skills_marketing_analist[15:31]  
#count the number of advertisements in which each skill is mentioned
occurences_marketing_analist <- colSums(subset_marketing_analist != 0)
#percentage of total number of advertisements
percentage_marketing_analist <- occurences_marketing_analist/nrow(subset_marketing_analist)
#add skillnames into the dataframe 
percentage_marketing_analist <- as.data.frame(percentage_marketing_analist)
percentage_marketing_analist$Skill <- c("SQL","HTML","SPSS","Power BI", "AWS", "Python", "Hadoop", "Java", "Apache", "Excel", "Azure", "Tableau", "TensorFlow", "big_data", "machine_learning", "SAS", "R")
#plot the percentage of occurence per skill level
percentage_plot_marketing_analist <- ggplot(data=percentage_marketing_analist, aes(x=Skill, y=percentage_marketing_analist)) + geom_bar(stat="identity") + coord_flip()
percentage_plot_marketing_analist
```

The Percentage plot shows very similar results to the count plot. Again, Excel is the clear winner, with mentions in over 1/3 of the job descriptions. sQL, Python, R and Tableau follow on respected distance with all being roughly equally relevant for marketing analysts to learn. 

### 2.4 Getting the skill counts for the most important skills in marketeer jobs

```{r}
skills_marketeer <- marketeer %>%
  mutate(SQL = str_count(marketeer$description, "SQL" )) %>%
  mutate(HTML = str_count(marketeer$description, "HTML")) %>%
  mutate(SPSS = str_count(marketeer$description, "SPSS")) %>%
  mutate(PowerBI = str_count(marketeer$description, "Power BI")) %>%
  mutate(AWS = str_count(marketeer$description, "AWS")) %>%
  mutate(Python = str_count(marketeer$description, "Python" )) %>%
  mutate(Hadoop = str_count(marketeer$description, "Hadoop" )) %>%
  mutate(Java = str_count(marketeer$description, "Java" )) %>%
  mutate(Apache = str_count(marketeer$description, "Apache" )) %>%
  mutate(Excel = str_count(marketeer$description, "Excel")) %>%
  mutate(AWS = str_count(marketeer$description, "AWS"))%>%
  mutate(Azure = str_count(marketeer$description, "Azure"))%>% 
  mutate(Tableau = str_count(marketeer$description, "Tableau" )) %>%
  mutate(TensorFlow = str_count(marketeer$description, "TensorFlow" )) %>%  
  mutate(big_data = str_count(marketeer$description, "big data" )) %>% 
  mutate(machine_learning = str_count(marketeer$description, "machine learning" )) %>%
  mutate(SAS = str_count(marketeer$description, "SAS" )) %>% 
  mutate(R = str_count(marketeer$description, "\\bR\\b" ))# add\\bR\\b because otherwise words all capital letter R's will be counted, which includes any r at the beginning of a sentence.
```

```{r}
#get only skills and their counts from the entire skills dataframe
table_marketeer <- gather(skills_marketeer,"Skill", "Count", 15:31) %>%  arrange( Count) 
#make a plot of the counts for each skill
count_plot_marketeer <- ggplot(data=table_marketeer, aes(x=Skill, y=Count)) + geom_bar(stat="identity") + coord_flip()#flip coordinates because skills on x axis gives messy text
count_plot_marketeer
```
For Marketeers, it is clear that technical skills are less important than for the other jobs, which involve more data related tasks. Despite this fact, Excel is still valuable, being the clear winner for marketeers in terms of technical skills. 2nd spot is for HTML, which is seen as a valuable skill for marketeers to have. Other slightly important skills are R and SQL, with each of the other skills being almost equal to 0 in terms of occurrences in the job ads for marketeers. 

```{r}
#get the count data from the entire dataset
subset_marketeer <- skills_marketeer[15:31]
#count the number of advertisements in which each skill is mentioned
occurences_marketeer <- colSums(subset_marketeer != 0)
#percentage of total number of advertisements
percentage_marketeer <- occurences_marketeer/nrow(subset_marketeer)
#add skillnames into the dataframe 
percentage_marketeer <- as.data.frame(percentage_marketeer)
percentage_marketeer$Skill <- c("SQL","HTML","SPSS", "Power BI",  "AWS", "Python", "Hadoop", "Java", "Apache", "Excel", "Azure", "Tableau", "TensorFlow", "big_data", "machine_learning", "SAS", "R")
#plot the percentage of occurence per skill level
percentage_plot_marketeer <- ggplot(data=percentage_marketeer, aes(x=Skill, y=percentage_marketeer))+ geom_bar(stat="identity") + coord_flip()
percentage_plot_marketeer
```

Similar results in percentage, which show that the technical skills get mentioned really infrequently in the job advertisements. Excel the winner in terms of technical skills gets mentioned in only 8 percent of job ads. Compared with winner skills for other job searches reaching over 30-40 %, there is a clear difference in the job requirements for marketeers. 

### 2.5 Getting insights into comparing the skills from the 4 job titles
#### Combining the seperate bar charts presented above into one bar graph, to conveniently compare the skills occurence for our 4 job searches. In the following section we will provide a comprehensive graph which shows each skill percentage occurrence for each job next to eachother. In order to facilitate direct comparison. 

```{r}
#merge different percentage for skills into one data frame
percentage <- merge(percentage_marketeer, percentage_data_analist, by = "Skill") 
percentage <- merge(percentage, percentage_data_science, by = "Skill")
percentage <- merge(percentage, percentage_marketing_analist, by = "Skill")

colnames(percentage) <- c("Skill", "marketeer", "data_analist", "data_scientist", "marketing_analist")
```

```{r}
df <- melt(percentage, id.vars="Skill")
colnames(df) <- c("Skill", "Job", "Occurence")
plot_skills <- ggplot(df, aes(x= Skill, y = Occurence, fill=Job)) +
  geom_bar(stat='identity', position='dodge') + coord_flip()
plot_skills
```
The top 4 skills in general are Python, R, SQL and Excel. With data scientist relying heavily on Python whereas fo marketing and data analysts it might be more fruitful to invest in your SQL skills. There seems a clear discrepancy between the R and SPSS heavy academic courses and the actual skills required by companies, more focused on SQL and Python to perform job tasks. Especially SQL is completely missing from the Master in Marketing analytics curriculum. Whereas Python is available in a few courses only. 

# 3. Location frequency analysis

```{r echo=FALSE, warning=FALSE, message=FALSE}
data_scientist_location <- read.csv("../../gen/data-preparation/output/data_scientist_clean.csv")
data_analist_location <- read.csv("../../gen/data-preparation/output/data_analist_clean.csv")
marketing_analist_location <- read.csv("../../gen/data-preparation/output/marketing_analist_clean.csv")
marketeer_location <- read.csv("../../gen/data-preparation/output/marketeer_clean.csv")
```

### 3.1 Location frequency data science

```{r}
data_scientist_location <- as.data.frame(table(data_scientist$location))
data_scientist_location <- data_scientist_location %>% filter(Freq > 10)
data_scientist_location$Location <- data_scientist_location$Var1
data_scientist_location_plot <- ggplot(data_scientist_location, aes(x = Location, y = Freq)) + geom_bar(stat="identity") + coord_flip()  
data_scientist_location_plot 
```
Amsterdam seems the place to be as a data scientist, with counts over 200, or roughly 1/3 of the entire number of jobs posted being in Amsterdam. Furthermore, as expected, the randstad features the most in job ads, with Utrecht, Rotterdam and Leiden coming in high as well. Outside of the randstad, Noord-Brabant in the form of Eindhoven and Den Bosch provide a decent number of  job opportunities. 

### 3.2 Location frequency data analist

```{r}
data_analist_location <- as.data.frame(table(data_analist$location))
data_analist_location <- data_analist_location %>% filter(Freq > 10)
data_analist_location$Location <- data_analist_location$Var1
data_analist_location_plot <- ggplot(data_analist_location, aes(x = Location, y = Freq)) + geom_bar(stat="identity") + coord_flip()  
data_analist_location_plot
```
For data analysts, the picture is quite similar. Amsterdam again is the clear winner in terms of number of jobs offered, however, Utrecht seems relatively more important for data analysts compared to data scientists. Rotterdam again is number 3, with Den Haag and Eindhoven completing the top 5 in terms of locations. 

### 3.3 Location frequency marketing analist

```{r}
marketing_analist_location <- as.data.frame(table(marketing_analist$location))
marketing_analist_location <- marketing_analist_location %>% filter(Freq > 10)
marketing_analist_location$Location <- marketing_analist_location$Var1
marketing_analist_location_plot <- ggplot(marketing_analist_location, aes(x = Location, y = Freq)) + geom_bar(stat="identity") + coord_flip()  
marketing_analist_location_plot
```
For Marketing analysts we see the same top 5 as for data analysts. However, Utrecht, Rotterdam and Den Haag all have almost equal counts of Job offers and Amsterdam is a way more pronounced winner for Marketing analysts than for the other jobs scrutinized before. 
### 3.4 Location frequency marketeer

```{r}
marketeer_location<- as.data.frame(table(marketeer$location))
marketeer_location <- marketeer_location %>% filter(Freq > 10)
marketeer_location$Location <- marketeer_location$Var1
marketeer_location_plot <- ggplot(marketeer_location, aes(x = Location, y = Freq)) + geom_bar(stat="identity") + coord_flip()  
marketeer_location_plot
```
For Marketeers, it seems that there are more opportunities outside of the randstad available compared to the 3 data related jobs. Cities as Breda, Arnhem, Deventer and Nijmegen come in quite close to the randstad cities such as Rotterdam and Utrecht, suggesting that the job opportunities for marketeers are more evenly spread across the country. 
### 3.5 Getting insights into comparing the locations of the 4 job titles
```{r}
location <- merge(marketeer_location, data_analist_location, by = "Location")
location <- merge(location, data_scientist_location, by = "Location")
location <- merge(location, marketing_analist_location, by = "Location")
location <- location[ , -which(names(location) %in% c("Var1.x","Var1.y"))]
colnames(location) <- c("Location", "marketeer", "data_analist", "data_scientist", "marketing_analist")

location <- melt(location, id.vars="Location")
colnames(location) <- c("Location", "Job", "Frequency")
plot_location <- ggplot(location, aes(x= Location, y = Frequency, fill=Job)) +
  geom_bar(stat='identity', position='dodge') + coord_flip()
plot_location

```
This graph show the top 5(plus remote) locations for job ads. As expected, Amsterdam is the clear winner for each job in terms of number of job offers, however the difference is less pronounced for marketeer related jobs than the other 3 jobs. Utrecht comes in 2nd in terms of number of job fofers whereas Rotterdam, Eindhoven and Den Haag are very equally ranked. 

Now that we know what the most important skills are to learn for our 4 jobs and also what the best cities are to go to, to find a job quickly, we analyze the best jobs and locations in terms of pay. 

# 4. Salary analysis
The salary data needs to be cleaned first. 
```{r echo=FALSE, warning=FALSE, message=FALSE}
data_scientist <- read.csv("../../gen/data-preparation/output/data_scientist_clean.csv")
data_analist <- read.csv("../../gen/data-preparation/output/data_analist_clean.csv")
marketing_analist<- read.csv("../../gen/data-preparation/output/marketing_analist_clean.csv")
marketeer <- read.csv("../../gen/data-preparation/output/marketeer_clean.csv")
```

- Cleaning the salary column, which has either hourly, monthly or yearly values.
- Converting the values into yearly salary based on the number of working hours in a year for an average job
- Important to note is that in many instances, the salary is given as a range. The new output will represent the lower bound of this range: min_salary

### 4.1 Salary analysis

Cleaning the salary data

```{r}
data_scientist_salary <- data_scientist %>% 
  mutate(salary1 = str_remove_all(salary, '[^0-9-,ÃÂ¢,ÃÂ¬]+')) %>% 
  separate(salary1, into = c('salary1', 'salary2'), 
           convert = TRUE, extra = 'drop') %>%
  mutate(across(c(salary1, salary2),
                ~ case_when(str_detect(salary, "per maand") ~ . * 12, 
                            str_detect(salary, 'per uur') ~ . * 40 * 4 * 12, 
                            nchar(.) < 5 ~ as.numeric(str_pad(., pad = '0', 
                                                              side = 'right', width = 5)),
                            TRUE ~ as.numeric(.)))) %>% 
  transmute(min_salary_ds = rowMeans(select(., salary1, salary2), na.rm = TRUE))

data_scientist_salary <- cbind(data_scientist, data_scientist_salary)

data_scientist_salary <- data_scientist_salary[!is.na(data_scientist_salary$min_salary_ds),]
# discard the column X.1 as it is a duplicate of the index column 
data_scientist_salary$X.1 <- NULL


data_analist_salary <- data_analist %>% 
  mutate(salary1 = str_remove_all(salary, '[^0-9-,ÃÂ¢,ÃÂ¬]+')) %>% 
  separate(salary1, into = c('salary1', 'salary2'), 
           convert = TRUE, extra = 'drop') %>%
  mutate(across(c(salary1, salary2),
                ~ case_when(str_detect(salary, "per maand") ~ . * 12, 
                            str_detect(salary, 'per uur') ~ . * 40 * 4 * 12, 
                            nchar(.) < 5 ~ as.numeric(str_pad(., pad = '0', 
                                                              side = 'right', width = 5)),
                            TRUE ~ as.numeric(.)))) %>% 
  transmute(min_salary_da = rowMeans(select(., salary1, salary2), na.rm = TRUE))

# join the two data frames
data_analist_salary <- cbind(data_analist, data_analist_salary)
data_analist_salary <- data_analist_salary[!is.na(data_analist_salary$min_salary_da),]

# discard the column X.1 as it is a duplicate of the index column 
data_analist_salary$X.1 <- NULL



marketing_analist_salary  <- marketing_analist %>% 
  mutate(salary1 = str_remove_all(salary, '[^0-9-,ÃÂ¢,ÃÂ¬]+')) %>% 
  separate(salary1, into = c('salary1', 'salary2'), 
           convert = TRUE, extra = 'drop') %>%
  mutate(across(c(salary1, salary2),
                ~ case_when(str_detect(salary, "per maand") ~ . * 12, 
                            str_detect(salary, 'per uur') ~ . * 40 * 4 * 12, 
                            nchar(.) < 5 ~ as.numeric(str_pad(., pad = '0', 
                                                              side = 'right', width = 5)),
                            TRUE ~ as.numeric(.)))) %>% 
  transmute(min_salary_ma = rowMeans(select(., salary1, salary2), na.rm = TRUE))

# join the two data frames
marketing_analist_salary   <- cbind(marketing_analist, marketing_analist_salary  )
marketing_analist_salary  <- marketing_analist_salary  [!is.na(marketing_analist_salary$min_salary_ma),]

# discard the column X.1 as it is a duplicate of the index column 
marketing_analist_salary$X.1 <- NULL


marketeer_salary  <- marketeer %>% 
  mutate(salary1 = str_remove_all(salary, '[^0-9-,ÃÂ¢,ÃÂ¬]+')) %>% 
  separate(salary1, into = c('salary1', 'salary2'), 
           convert = TRUE, extra = 'drop') %>%
  mutate(across(c(salary1, salary2),
                ~ case_when(str_detect(salary, "per maand") ~ . * 12, 
                            str_detect(salary, 'per uur') ~ . * 40 * 4 * 12, 
                            nchar(.) < 5 ~ as.numeric(str_pad(., pad = '0', 
                                                              side = 'right', width = 5)),
                            TRUE ~ as.numeric(.)))) %>% 
  transmute(min_salary_m = rowMeans(select(., salary1, salary2), na.rm = TRUE))

# join the two data frames
marketeer_salary  <- cbind(marketeer, marketeer_salary )
marketeer_salary <- marketeer_salary[!is.na(marketeer_salary$min_salary_m),]

# discard the column X.1 as it is a duplicate of the index column 
marketeer_salary$X.1 <- NULL
```
### mean salaries per job 
```{r}

#finding the mean salary per job
avg_salary_data_science <- mean(data_scientist_salary$salary_good)
avg_salary_data_analist <- mean(data_analist_salary$salary_good)
avg_salary_marketing_analist <- mean(marketing_analist_salary$salary_good)
avg_salary_marketeer <- mean(marketeer_salary$salary_good)

job <- c("Data Scientist","Data analist",  "Marketing analist", "Marketeer")
salary <- c( avg_salary_data_science, avg_salary_data_analist, avg_salary_marketing_analist, avg_salary_marketeer)

df_salary <- data.frame(job, salary)

plot_mean_salary <- plot(ggplot(df_salary, aes(x = job, y = salary)) + geom_bar(stat='identity'))

```

### top locations for data scientists

```{r}
# average salaries per location for top locations for data scientists
data_scientist_avgsalary <- data_scientist_salary %>% 
  group_by(location) %>%                 
  summarise(average_salary = mean(salary_good)) 

# filter cities with over 30000 euro's average yearly salary
data_scientist_avgsalary  <- data_scientist_avgsalary %>%
  filter(data_scientist_avgsalary$average_salary > 30000)
# build a plot of the locations with the highest average salary in the Netherlands
data_scientist_salary_plot <- ggplot(data_scientist_avgsalary, aes(x = location, y = average_salary)) + geom_bar(stat='identity') + coord_flip()
data_scientist_salary_plot
```

### top locations for data analist

```{r}
# average salaries per location for top locations for data analists
data_analist_avgsalary <- data_analist_salary %>% 
  group_by(location) %>%                 
  summarise(average_salary = mean(salary_good)) 

# filter cities with over 30000 euro's average yearly salary
data_analist_avgsalary <- data_analist_avgsalary  %>%
  filter(data_analist_avgsalary$average_salary > 30000)

# build a plot of the locations with the highest average salary in the Netherlands
data_analist_salary_plot <- ggplot(data_analist_avgsalary, aes(x = location, y = average_salary)) + geom_bar(stat='identity') + coord_flip()
data_analist_salary_plot
```

### top locations for marketing analist

```{r}
# average salaries per location for top locations for marketing analists
marketing_analist_avgsalary <-marketing_analist_salary %>% 
  group_by(location) %>%                 
  summarise(average_salary = mean(salary_good)) 

# filter cities with over 30000 euro's average yearly salary
marketing_analist_avgsalary <-   marketing_analist_avgsalary %>%
  filter(marketing_analist_avgsalary$average_salary > 30000)

# build a plot of the locations with the highest average salary in the Netherlands
marketing_analist_salary_plot <- ggplot(marketing_analist_avgsalary, aes(x = location, y = average_salary)) + geom_bar(stat='identity') + coord_flip()
marketing_analist_salary_plot
```

### top locations for marketeer

```{r}
# average salaries per location for top locations for  marketeers
marketeer_avgsalary <- marketeer_salary %>% 
  group_by(location) %>%                 
  summarise(average_salary = mean(salary_good)) 

# filter cities with over 30000 euro's average yearly salary
marketeer_avgsalary <- marketeer_avgsalary %>%
  filter(marketeer_avgsalary$average_salary > 30000)
# build a plot of the locations with the highest average salary in the Netherlands
marketeer_salary_plot <- ggplot(marketeer_avgsalary, aes(x = location, y = average_salary)) + geom_bar(stat='identity') + coord_flip()
marketeer_salary_plot
```

### 4.5 Getting insights into comparing the salaries of the 4 job titles on the best locations

```{r}
# combined plot
# first merge the different files
salary <- merge(marketeer_avgsalary, data_analist_avgsalary, by = "location")
salary <- merge(salary, data_scientist_avgsalary, by = "location")
salary <- merge(salary, marketing_analist_avgsalary, by = "location")
colnames(salary) <- c("Location", "marketeer", "data_analist", "data_scientist", "marketing_analist")
# put all jobs in a column 
salary <- melt(salary, id.vars="Location")
colnames(salary) <- c("Location", "Job", "Salary")
plot_salary <- ggplot(salary, aes(x= Location, y = Salary, fill=Job)) +
  geom_bar(stat='identity', position='dodge') + coord_flip()
plot_salary
```
---
title: "Data exploration & Analysis"
output: html_document
---

```{r echo=FALSE, warning=FALSE, message=FALSE}
library(dplyr)
library(ggplot2)
```


```{r echo=FALSE, warning=FALSE, message=FALSE}
## 1.1 data scientist ---------------------------------------------------------
df_ds <- read.csv('../../gen/data-preparation/output/data_scientist_clean.csv', sep = ',')

## 1.2 data analist -----------------------------------------------------------
df_da <- read.csv('../../gen/data-preparation/output/data_analist_clean.csv', sep = ',')

## 1.3 marketing analist ------------------------------------------------------
df_ma <- read.csv('../../gen/data-preparation/output/marketing_analist_clean.csv', sep = ',')

## 1.4 marketeer --------------------------------------------------------------
df_m <- read.csv('../../gen/data-preparation/output/marketeer_clean.csv', sep = ',')
```

# 1. Overview of the data

### This is how the data_scientist data set looks like:
We can see that there are `r length(df_ds$X)` job listings.

```{r}
colnames(df_ds)
```

```{r}
summary(df_ds)
```

### This is how the data_analist data set looks like:
We can see that there are `r length(df_da$X)` job listings.

```{r}
colnames(df_da)
```

```{r}
summary(df_da)
```

### This is how the marketing_analist data set looks like:
We can see that there are `r length(df_ma$X)` job listings.

```{r}
colnames(df_ma)
```

```{r}
summary(df_ma)
```

### This is how the marketeer data set looks like:
We can see that there are `r length(df_m$X)` job listings.

```{r}
colnames(df_m)
```

```{r}
summary(df_m)
```

# 2. Looking at the data as a whole
#### 2.1 First, we'll add a new column containing the search term for each dataset, that can be later used as a filter.
#### 2.2 Then, we'll bind the four datasets to check for duplicates

```{r echo=FALSE, warning=FALSE, message=FALSE}
df_ds$serchterm <- "data_scientist"
df_da$serchterm <- "data_analist"
df_ma$serchterm <- "marketing_analist"
df_m$serchterm <- "marketeer"
```

```{r echo=FALSE, warning=FALSE, message=FALSE}
# bind the datasets together
all_listings <- rbind(df_ds, df_da, df_ma, df_m)
```

We can see that the new dataframe all_listings has `r length(all_listings$X)` listings, however, the number of unique listings is `r length(unique(all_listings$id))`.


```{r echo=FALSE, warning=FALSE, message=FALSE}
# Change today column and scrapetimesdescription column from character to date

today <- as.Date(all_listings$today, format = "%Y-%m-%d")
all_listings$today <- today


scrapetimesdescription <- as.Date(all_listings$scrapetimesdescription, format = "%Y-%m-%d %H:%M:%S")
all_listings$scrapetimesdescription <- scrapetimesdescription
```

### Checking the distribution of the min_salary for the listings that contain this data


#```{r}
#ggplot(all_listings, aes(x=min_salary)) +
#  geom_histogram(binwidth=.5, colour="black", fill="white")
#```


# 3. Keywords
#### 2.1 Data scientist

```{r}
df_ds <- df_ds %>% distinct(id, .keep_all = TRUE)
#get the skill counts for the most important skills in data analysis
skills_ds <- df_ds %>%
  mutate(SQL = str_count(df_ds$description, "SQL" )) %>%
  mutate(HTML = str_count(df_ds$description, "HTML")) %>%
  mutate(SPSS = str_count(df_ds$description, "SPSS")) %>%
  mutate(AWS = str_count(df_ds$description, "AWS")) %>%
  mutate(Python = str_count(df_ds$description, "Python" )) %>%
  mutate(Hadoop = str_count(df_ds$description, "Hadoop" )) %>%
  mutate(Java = str_count(df_ds$description, "Java" )) %>%
  mutate(Apache = str_count(df_ds$description, "Apache" )) %>%
  mutate(Excel = str_count(df_ds$description, "Excel")) %>%
  mutate(AWS = str_count(df_ds$description, "AWS"))%>%
  mutate(Azure = str_count(df_ds$description, "Azure"))%>% 
  mutate(Tableau = str_count(df_ds$description, "Tableau" )) %>%
  mutate(TensorFlow = str_count(df_ds$description, "TensorFlow" )) %>%  
  mutate(big_data = str_count(df_ds$description, "big data" )) %>% 
  mutate(machine_learning = str_count(df_ds$description, "machine learning" )) %>%
  mutate(SAS = str_count(df_ds$description, "SAS" )) %>% 
  mutate(R = str_count(df_ds$description, "\\bR\\b" ))

```

```{r}
#get only skills and their counts from the entire skills dataframe
table_ds <- gather(skills_ds, "skill", "Count", 14:29) %>%  arrange( Count) 
#make a plot of the counts for each skill
count_plot_ds <- ggplot(data=table_ds, aes(x=skill, y=Count)) + geom_bar(stat="identity") + coord_flip()#flip coordinates because skills on x axis gives messy text

count_plot_ds
```
```{r}
#get the count data from the entire dataset
subset_ds <- skills_ds[14:29]
#count the number of advertisements in which each skill is mentioned
occurences_ds <- colSums(subset_ds != 0)
#percentage of total number of advertisements
percentage_occurence_ds <- occurences_ds/nrow(subset_ds)
percentage_occurence_ds
#add skillnames into the dataframe 
percentage_ds <- as.data.frame(percentage_occurence_ds)
percentage_ds$row_names <- c("SQL","HTML", "SPSS", "AWS", "Python", "Hadoop", "Java", "Apache", "Excel", "Azure", "Tableau", "TensorFlow", "big_data", "machine_learning", "SAS", "R")
#plot the percentage of occurence per skill level
percentage_plot_ds <- ggplot(data=percentage_ds, aes(x=row_names, y=percentage_occurence_ds)) + geom_bar(stat="identity") + coord_flip()
percentage_plot_ds

```
#### 2.2 Data analist

```{r}
skills_ma <- df_ma %>%
  mutate(SQL = str_count(df_ma$description, "SQL" )) %>%
  mutate(HTML = str_count(df_ma$description, "HTML")) %>%
  mutate(SPSS = str_count(df_ma$description, "SPSS")) %>%
  mutate(AWS = str_count(df_ma$description, "AWS")) %>%
  mutate(Python = str_count(df_ma$description, "Python" )) %>%
  mutate(Hadoop = str_count(df_ma$description, "Hadoop" )) %>%
  mutate(Java = str_count(df_ma$description, "Java" )) %>%
  mutate(Apache = str_count(df_ma$description, "Apache" )) %>%
  mutate(Excel = str_count(df_ma$description, "Excel")) %>%
  mutate(AWS = str_count(df_ma$description, "AWS"))%>%
  mutate(Azure = str_count(df_ma$description, "Azure"))%>% 
  mutate(Tableau = str_count(df_ma$description, "Tableau" )) %>%
  mutate(TensorFlow = str_count(df_ma$description, "TensorFlow" )) %>%  
  mutate(big_data = str_count(df_ma$description, "big data" )) %>% 
  mutate(machine_learning = str_count(df_ma$description, "machine learning" )) %>%
  mutate(SAS = str_count(df_ma$description, "SAS" )) %>% 
  mutate(R = str_count(df_ma$description, "\\bR\\b" ))# add\\bR\\b because otherwise words all capital letter R's will be counted, which includes any r at the beginning of a sentence.
```

```{r}
#get the count data from the entire dataset
subset_ma <- skills_ma[14:29]  
#count the number of advertisements in which each skill is mentioned
occurences_ma <- colSums(subset_ma != 0)
#percentage of total number of advertisements
percentage_occurence_ma <- occurences_ma/nrow(subset_ma)
percentage_occurence_ma
#add skillnames into the dataframe 
percentage_ma <- as.data.frame(percentage_occurence_ma)
percentage_ma$row_names <- c("SQL","HTML","SPSS", "AWS", "Python", "Hadoop", "Java", "Apache", "Excel", "Azure", "Tableau", "TensorFlow", "big_data", "machine_learning", "SAS", "R")
#plot the percentage of occurence per skill level
percentage_plot_ma <- ggplot(data=percentage_ma, aes(x=row_names, y=percentage_occurence_ma)) + geom_bar(stat="identity") + coord_flip()
percentage_plot_ma
```


#### 2.3 Marketeer

```{r}
skills_m <- df_m %>%
  mutate(SQL = str_count(df_m$description, "SQL" )) %>%
  mutate(HTML = str_count(df_m$description, "HTML")) %>%
  mutate(SPSS = str_count(df_m$description, "SPSS")) %>%
  mutate(AWS = str_count(df_m$description, "AWS")) %>%
  mutate(Python = str_count(df_m$description, "Python" )) %>%
  mutate(Hadoop = str_count(df_m$description, "Hadoop" )) %>%
  mutate(Java = str_count(df_m$description, "Java" )) %>%
  mutate(Apache = str_count(df_m$description, "Apache" )) %>%
  mutate(Excel = str_count(df_m$description, "Excel")) %>%
  mutate(AWS = str_count(df_m$description, "AWS"))%>%
  mutate(Azure = str_count(df_m$description, "Azure"))%>% 
  mutate(Tableau = str_count(df_m$description, "Tableau" )) %>%
  mutate(TensorFlow = str_count(df_m$description, "TensorFlow" )) %>%  
  mutate(big_data = str_count(df_m$description, "big data" )) %>% 
  mutate(machine_learning = str_count(df_m$description, "machine learning" )) %>%
  mutate(SAS = str_count(df_m$description, "SAS" )) %>% 
  mutate(R = str_count(df_m$description, "\\bR\\b" ))# add\\bR\\b because otherwise words all capital letter R's will be counted, which includes any r at the beginning of a sentence. 

```


```{r}
#get the count data from the entire dataset
subset_m <- skills_m[14:29]  
#count the number of advertisements in which each skill is mentioned
occurences_m <- colSums(subset_m != 0)
#percentage of total number of advertisements
percentage_occurence_m <- occurences_m/nrow(subset_m)
percentage_occurence_m
#add skillnames into the dataframe 
percentage_m <- as.data.frame(percentage_occurence_m)
percentage_m$row_names <- c("SQL","HTML","SPSS", "AWS", "Python", "Hadoop", "Java", "Apache", "Excel", "Azure", "Tableau", "TensorFlow", "big_data", "machine_learning", "SAS", "R")
#plot the percentage of occurence per skill level
percentage_plot_m <- ggplot(data=percentage_m, aes(x=row_names, y=percentage_occurence_m)) + geom_bar(stat="identity") + coord_flip()
percentage_plot_m
```